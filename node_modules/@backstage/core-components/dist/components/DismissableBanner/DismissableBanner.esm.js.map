{"version":3,"file":"DismissableBanner.esm.js","sources":["../../../src/components/DismissableBanner/DismissableBanner.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode, useState, useEffect } from 'react';\nimport { useApi, storageApiRef } from '@backstage/core-plugin-api';\nimport useObservable from 'react-use/esm/useObservable';\nimport classNames from 'classnames';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport Close from '@material-ui/icons/Close';\n\n/** @public */\nexport type DismissableBannerClassKey =\n  | 'root'\n  | 'topPosition'\n  | 'icon'\n  | 'content'\n  | 'message'\n  | 'info'\n  | 'error';\n\n/**\n * @public\n * @deprecated This type contained a typo, please use DismissableBannerClassKey instead\n */\nexport type DismissbleBannerClassKey = DismissableBannerClassKey;\n\nconst useStyles = makeStyles(\n  theme => ({\n    root: {\n      padding: theme.spacing(0),\n      marginBottom: theme.spacing(0),\n      marginTop: theme.spacing(0),\n      display: 'flex',\n      flexFlow: 'row nowrap',\n    },\n    // showing on top\n    topPosition: {\n      position: 'relative',\n      marginBottom: theme.spacing(6),\n      marginTop: -theme.spacing(3),\n      zIndex: 'unset',\n    },\n    icon: {\n      fontSize: theme.typography.h6.fontSize,\n    },\n    content: {\n      width: '100%',\n      maxWidth: 'inherit',\n      flexWrap: 'nowrap',\n      color: theme.palette.banner.text,\n    },\n    message: {\n      display: 'flex',\n      alignItems: 'center',\n      '& a': {\n        color: theme.palette.banner.link,\n      },\n    },\n    button: {\n      color: theme.palette.banner.closeButtonColor ?? 'inherit',\n    },\n    info: {\n      backgroundColor: theme.palette.banner.info,\n    },\n    error: {\n      backgroundColor: theme.palette.banner.error,\n    },\n    warning: {\n      backgroundColor:\n        theme.palette.banner.warning ?? theme.palette.banner.error,\n    },\n  }),\n  { name: 'BackstageDismissableBanner' },\n);\n\nexport type Props = {\n  variant: 'info' | 'error' | 'warning';\n  message: ReactNode;\n  id: string;\n  fixed?: boolean;\n};\n\n/** @public */\nexport const DismissableBanner = (props: Props) => {\n  const { variant, message, id, fixed = false } = props;\n  const classes = useStyles();\n  const storageApi = useApi(storageApiRef);\n  const notificationsStore = storageApi.forBucket('notifications');\n  const rawDismissedBanners =\n    notificationsStore.snapshot<string[]>('dismissedBanners').value ?? [];\n\n  const [dismissedBanners, setDismissedBanners] = useState(\n    new Set(rawDismissedBanners),\n  );\n\n  const observedItems = useObservable(\n    notificationsStore.observe$<string[]>('dismissedBanners'),\n  );\n\n  useEffect(() => {\n    if (observedItems?.value) {\n      const currentValue = observedItems?.value ?? [];\n      setDismissedBanners(new Set(currentValue));\n    }\n  }, [observedItems?.value]);\n\n  const handleClick = () => {\n    notificationsStore.set('dismissedBanners', [...dismissedBanners, id]);\n  };\n\n  return (\n    <Snackbar\n      anchorOrigin={\n        fixed\n          ? { vertical: 'bottom', horizontal: 'center' }\n          : { vertical: 'top', horizontal: 'center' }\n      }\n      open={!dismissedBanners.has(id)}\n      classes={{\n        root: classNames(classes.root, !fixed && classes.topPosition),\n      }}\n    >\n      <SnackbarContent\n        classes={{\n          root: classNames(classes.content, classes[variant]),\n          message: classes.message,\n        }}\n        message={message}\n        action={[\n          <IconButton\n            key=\"dismiss\"\n            title=\"Permanently dismiss this message\"\n            className={classes.button}\n            onClick={handleClick}\n          >\n            <Close className={classes.icon} />\n          </IconButton>,\n        ]}\n      />\n    </Snackbar>\n  );\n};\n"],"names":["_a","Close"],"mappings":";;;;;;;;;;AA0CA,MAAM,SAAY,GAAA,UAAA;AAAA,EAChB,CAAM,KAAA,KAAA;AA3CR,IAAA,IAAA,EAAA,EAAA,EAAA,CAAA;AA2CY,IAAA,OAAA;AAAA,MACR,IAAM,EAAA;AAAA,QACJ,OAAA,EAAS,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,QACxB,YAAA,EAAc,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,QAC7B,SAAA,EAAW,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,QAC1B,OAAS,EAAA,MAAA;AAAA,QACT,QAAU,EAAA,YAAA;AAAA,OACZ;AAAA;AAAA,MAEA,WAAa,EAAA;AAAA,QACX,QAAU,EAAA,UAAA;AAAA,QACV,YAAA,EAAc,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,QAC7B,SAAW,EAAA,CAAC,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,QAC3B,MAAQ,EAAA,OAAA;AAAA,OACV;AAAA,MACA,IAAM,EAAA;AAAA,QACJ,QAAA,EAAU,KAAM,CAAA,UAAA,CAAW,EAAG,CAAA,QAAA;AAAA,OAChC;AAAA,MACA,OAAS,EAAA;AAAA,QACP,KAAO,EAAA,MAAA;AAAA,QACP,QAAU,EAAA,SAAA;AAAA,QACV,QAAU,EAAA,QAAA;AAAA,QACV,KAAA,EAAO,KAAM,CAAA,OAAA,CAAQ,MAAO,CAAA,IAAA;AAAA,OAC9B;AAAA,MACA,OAAS,EAAA;AAAA,QACP,OAAS,EAAA,MAAA;AAAA,QACT,UAAY,EAAA,QAAA;AAAA,QACZ,KAAO,EAAA;AAAA,UACL,KAAA,EAAO,KAAM,CAAA,OAAA,CAAQ,MAAO,CAAA,IAAA;AAAA,SAC9B;AAAA,OACF;AAAA,MACA,MAAQ,EAAA;AAAA,QACN,KAAO,EAAA,CAAA,EAAA,GAAA,KAAA,CAAM,OAAQ,CAAA,MAAA,CAAO,qBAArB,IAAyC,GAAA,EAAA,GAAA,SAAA;AAAA,OAClD;AAAA,MACA,IAAM,EAAA;AAAA,QACJ,eAAA,EAAiB,KAAM,CAAA,OAAA,CAAQ,MAAO,CAAA,IAAA;AAAA,OACxC;AAAA,MACA,KAAO,EAAA;AAAA,QACL,eAAA,EAAiB,KAAM,CAAA,OAAA,CAAQ,MAAO,CAAA,KAAA;AAAA,OACxC;AAAA,MACA,OAAS,EAAA;AAAA,QACP,eAAA,EAAA,CACE,WAAM,OAAQ,CAAA,MAAA,CAAO,YAArB,IAAgC,GAAA,EAAA,GAAA,KAAA,CAAM,QAAQ,MAAO,CAAA,KAAA;AAAA,OACzD;AAAA,KACF,CAAA;AAAA,GAAA;AAAA,EACA,EAAE,MAAM,4BAA6B,EAAA;AACvC,CAAA,CAAA;AAUa,MAAA,iBAAA,GAAoB,CAAC,KAAiB,KAAA;AAnGnD,EAAA,IAAA,EAAA,CAAA;AAoGE,EAAA,MAAM,EAAE,OAAS,EAAA,OAAA,EAAS,EAAI,EAAA,KAAA,GAAQ,OAAU,GAAA,KAAA,CAAA;AAChD,EAAA,MAAM,UAAU,SAAU,EAAA,CAAA;AAC1B,EAAM,MAAA,UAAA,GAAa,OAAO,aAAa,CAAA,CAAA;AACvC,EAAM,MAAA,kBAAA,GAAqB,UAAW,CAAA,SAAA,CAAU,eAAe,CAAA,CAAA;AAC/D,EAAA,MAAM,uBACJ,EAAmB,GAAA,kBAAA,CAAA,QAAA,CAAmB,kBAAkB,CAAE,CAAA,KAAA,KAA1D,YAAmE,EAAC,CAAA;AAEtE,EAAM,MAAA,CAAC,gBAAkB,EAAA,mBAAmB,CAAI,GAAA,QAAA;AAAA,IAC9C,IAAI,IAAI,mBAAmB,CAAA;AAAA,GAC7B,CAAA;AAEA,EAAA,MAAM,aAAgB,GAAA,aAAA;AAAA,IACpB,kBAAA,CAAmB,SAAmB,kBAAkB,CAAA;AAAA,GAC1D,CAAA;AAEA,EAAA,SAAA,CAAU,MAAM;AAnHlB,IAAAA,IAAAA,GAAAA,CAAAA;AAoHI,IAAA,IAAI,+CAAe,KAAO,EAAA;AACxB,MAAA,MAAM,gBAAeA,GAAA,GAAA,aAAA,IAAA,IAAA,GAAA,KAAA,CAAA,GAAA,aAAA,CAAe,KAAf,KAAA,IAAA,GAAAA,MAAwB,EAAC,CAAA;AAC9C,MAAoB,mBAAA,CAAA,IAAI,GAAI,CAAA,YAAY,CAAC,CAAA,CAAA;AAAA,KAC3C;AAAA,GACC,EAAA,CAAC,aAAe,IAAA,IAAA,GAAA,KAAA,CAAA,GAAA,aAAA,CAAA,KAAK,CAAC,CAAA,CAAA;AAEzB,EAAA,MAAM,cAAc,MAAM;AACxB,IAAA,kBAAA,CAAmB,IAAI,kBAAoB,EAAA,CAAC,GAAG,gBAAA,EAAkB,EAAE,CAAC,CAAA,CAAA;AAAA,GACtE,CAAA;AAEA,EACE,uBAAA,KAAA,CAAA,aAAA;AAAA,IAAC,QAAA;AAAA,IAAA;AAAA,MACC,YACE,EAAA,KAAA,GACI,EAAE,QAAA,EAAU,QAAU,EAAA,UAAA,EAAY,QAAS,EAAA,GAC3C,EAAE,QAAA,EAAU,KAAO,EAAA,UAAA,EAAY,QAAS,EAAA;AAAA,MAE9C,IAAM,EAAA,CAAC,gBAAiB,CAAA,GAAA,CAAI,EAAE,CAAA;AAAA,MAC9B,OAAS,EAAA;AAAA,QACP,MAAM,UAAW,CAAA,OAAA,CAAQ,MAAM,CAAC,KAAA,IAAS,QAAQ,WAAW,CAAA;AAAA,OAC9D;AAAA,KAAA;AAAA,oBAEA,KAAA,CAAA,aAAA;AAAA,MAAC,eAAA;AAAA,MAAA;AAAA,QACC,OAAS,EAAA;AAAA,UACP,MAAM,UAAW,CAAA,OAAA,CAAQ,OAAS,EAAA,OAAA,CAAQ,OAAO,CAAC,CAAA;AAAA,UAClD,SAAS,OAAQ,CAAA,OAAA;AAAA,SACnB;AAAA,QACA,OAAA;AAAA,QACA,MAAQ,EAAA;AAAA,0BACN,KAAA,CAAA,aAAA;AAAA,YAAC,UAAA;AAAA,YAAA;AAAA,cACC,GAAI,EAAA,SAAA;AAAA,cACJ,KAAM,EAAA,kCAAA;AAAA,cACN,WAAW,OAAQ,CAAA,MAAA;AAAA,cACnB,OAAS,EAAA,WAAA;AAAA,aAAA;AAAA,4BAER,KAAA,CAAA,aAAA,CAAAC,SAAA,EAAA,EAAM,SAAW,EAAA,OAAA,CAAQ,IAAM,EAAA,CAAA;AAAA,WAClC;AAAA,SACF;AAAA,OAAA;AAAA,KACF;AAAA,GACF,CAAA;AAEJ;;;;"}